{% extends "layout.html" %}

{% block title %}
    New Pet
{% endblock %}

{% block main %}

    <h1>Add your pet data</h1>
    <form id="newPet" action="/new_pet" method="post" class="vertical_padding">
        <!-- Step 1 -->
        <div id="step1" class="step">
            <h2>Basic Information</h2>
            <label class="vertical_padding" for="name">Name:</label>
            <input type="text" id="name" name="name" placeholder="Pet name" required><br><br>

            <label for="birth_date">Birth date:</label>
            <input type="date" id="birth_date" name="birth_date"><br><br>

            <label for="adoption_date">Adoption date:</label>
            <input type="date" id="adoption_date" name="adoption_date"><br><br>

            <label for="sex">Sex:</label>
            <select id="sex" name="sex" required>
                <option value="M">Male</option>
                <option value="F">Female</option>
            </select><br><br>

            <label for="species">Specie:</label>
            <select id="species" name="species" required>
                <option value="" disabled selected>Select specie</option>
                {% for specie in species %}
                    <option value="{{ specie.id }}">{{ specie.name }}</option>
                {% endfor %}
            </select><br><br>

            <div id="breed-container">
                <label for="breed">Breed:</label>
                <select id="breed" name="breed" required>
                    <option value="" disabled selected>Select a breed</option>
                </select>
            </div><br><br>

                <button type="button" id="nextButton" class="continue-btn dark_btn btn">Continue</button>
        </div>

        <!-- Step 2 -->
        <div id="step2" class="step" style="display: none;">
            <h2>Health Data</h2>
            <label for="sterilized">Sterilized:</label>
            <select id="sterilized" name="sterilized" required>
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </select><br><br>

            <label for="microchip_number">Microchip (opcional):</label>
            <input type="text" id="microchip_number" name="microchip_number" placeholder="Microchip number"><br><br>

            <label for="insurance_company">Insurance Company (opcional):</label>
            <input type="text" id="insurance_company" name="insurance_company" placeholder="Insurance Company"><br><br>

            <label for="insurance_number">Insurance No.(opcional):</label>
            <input type="text" id="insurance_number" name="insurance_number" placeholder="Insurance No."><br><br>

            <button type="submit" class="submit-btn dark_btn btn">Register Pet</button>
        </div>
    </form>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>
        // Steps management
        $(document).ready(function() {
            // Show breeds depending on selected specie
            $('#species').change(function() {
                var species_id = $(this).val();
                var breedSelect = $('#breed');
                breedSelect.empty();
                breedSelect.append('<option value="" disabled selected>Loading breeds...</option>');

                $.ajax({
                    url: '/get_breeds/' + species_id,
                    method: 'GET',
                    success: function(data) {
                        console.log(data); // Log data for debugging
                        breedSelect.empty();
                        breedSelect.append('<option value="" disabled selected>Select a breed</option>');
                        $.each(data, function(index, breed) {
                            breedSelect.append('<option value="' + breed.id + '">' + breed.name + '</option>');
                        });
                    },
                    error: function(xhr, status, error) {
                        console.error("Error fetching breeds:", error);
                        alert("Failed to load breeds. Please try again.");
                    }
                });
            });

            $('#nextButton').click(function() {
                $('#step1').hide();
                $('#step2').show();
            });
        });
    </script>


{% endblock %}
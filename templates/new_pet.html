{% extends "layout.html" %}

{% block title %}
    New Pet
{% endblock %}

{% block main %}

    <h1>Add your pet data</h1>
    <form id="newPet" action="/new_pet" method="post" class="vertical_padding">
        {{ form.hidden_tag() }} 
        <!-- Step 1 -->
        <div id="step1" class="step">
            <!-- Renderize using Flask-WTF -->
            <h2>Basic Information</h2>
            <label class="vertical_padding" for="photo">Photo:</label>
            {{ form.pet_profile_photo() }}
            <br><br>
            <label  for="name">Name:</label>
            {{ form.name() }}  
            <br><br>
            <label for="birth_date">Birth date:</label>
            {{ form.birth_date() }}  
            <br><br>
            <label for="adoption_date">Adoption date:</label>
            {{ form.adoption_date() }}  
            <br><br>
            <label for="sex">Sex:</label>
            {{ form.sex() }}  
            <br><br>
            <label for="species">Specie:</label>
            {{ form.species() }}
            <br><br>
            <div id="breed-container">
                <label for="breed">Breed:</label>
                {{ form.breed() }}
            </div>
            <br><br>
            <button type="button" id="nextButton" class="continue-btn dark_btn btn">Continue</button>
        </div>

        <!-- Step 2 -->
        <div id="step2" class="step" style="display: none;">
            <h2>Health Data</h2>
            <label for="sterilized">Sterilized:</label>
            {{ form.sterilized() }}
            <br><br>
            <label for="microchip_number">Microchip (optional):</label>
            {{ form.microchip_number() }}
            <br><br>
            <label for="insurance_company">Insurance Company (optional):</label>
            {{ form.insurance_company() }}
            <br><br>
            <label for="insurance_number">Insurance No. (optional):</label>
            {{ form.insurance_number() }}
            <br><br>
            <button type="submit" class="submit-btn dark_btn btn">Register Pet</button>
        </div>
    </form>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>
        // Steps management
        $(document).ready(function() {
            // Show breeds depending on selected specie
            $('#species').change(function() {
                var species_id = $(this).val();
                var breedSelect = $('#breed');
                breedSelect.empty();
                breedSelect.append('<option value="" disabled selected>Loading breeds...</option>');

                $.ajax({
                    url: '/get_breeds/' + species_id,
                    method: 'GET',
                    success: function(data) {
                        console.log(data); // Log data for debugging
                        breedSelect.empty();
                        breedSelect.append('<option value="" disabled selected>Select a breed</option>');
                        $.each(data, function(index, breed) {
                            breedSelect.append('<option value="' + breed.id + '">' + breed.name + '</option>');
                        });
                    },
                    error: function(xhr, status, error) {
                        console.error("Error fetching breeds:", error);
                        alert("Failed to load breeds. Please try again.");
                    }
                });
            });

            $('#nextButton').click(function() {
                $('#step1').hide();
                $('#step2').show();
            });
        });
    </script>


{% endblock %}